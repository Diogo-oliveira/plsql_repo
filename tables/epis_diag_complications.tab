CREATE TABLE EPIS_DIAG_COMPLICATIONS
(
  ID_EPIS_DIAGNOSIS NUMBER(24) NOT NULL ENABLE,
  ID_COMPLICATION NUMBER(24) NOT NULL ENABLE,
  ID_ALERT_COMPLICATION NUMBER(24) NOT NULL ENABLE,
  FLG_STATUS VARCHAR2(1 CHAR) NOT NULL ENABLE,
  ID_PROF_CREATE NUMBER(24),
  DT_CREATE TIMESTAMP (6) WITH LOCAL TIME ZONE, 
  ID_PROF_UPD NUMBER(24),
  DT_UPD TIMESTAMP (6) WITH LOCAL TIME ZONE,
  RANK NUMBER(24),
  ------------------------------
  CREATE_USER VARCHAR2(24 CHAR),
  CREATE_TIME TIMESTAMP(6) WITH LOCAL TIME ZONE,
  CREATE_INSTITUTION NUMBER(24),
  UPDATE_USER VARCHAR2(24 CHAR),
  UPDATE_TIME TIMESTAMP(6) WITH LOCAL TIME ZONE,
  UPDATE_INSTITUTION NUMBER(24)
);

ALTER TABLE EPIS_DIAG_COMPLICATIONS ADD CONSTRAINT EDC_PK PRIMARY KEY (ID_EPIS_DIAGNOSIS, ID_COMPLICATION, ID_ALERT_COMPLICATION);
ALTER TABLE EPIS_DIAG_COMPLICATIONS ADD CONSTRAINT EDC_ED_FK FOREIGN KEY (ID_EPIS_DIAGNOSIS) REFERENCES EPIS_DIAGNOSIS (ID_EPIS_DIAGNOSIS);

COMMENT ON TABLE EPIS_DIAG_COMPLICATIONS IS 'Relation between episode diagnosis and registered complications';
COMMENT ON COLUMN EPIS_DIAG_COMPLICATIONS.ID_EPIS_DIAGNOSIS IS 'ID of episode diagnosis';
COMMENT ON COLUMN EPIS_DIAG_COMPLICATIONS.ID_COMPLICATION IS 'Id complication';
COMMENT ON COLUMN EPIS_DIAG_COMPLICATIONS.ID_ALERT_COMPLICATION IS 'Id ALERT Complication';
COMMENT ON COLUMN EPIS_DIAG_COMPLICATIONS.FLG_STATUS IS 'Status of the complication (A-Active; I-Inactive)';
COMMENT ON COLUMN EPIS_DIAG_COMPLICATIONS.ID_PROF_CREATE IS 'Professional who created the complication';
COMMENT ON COLUMN EPIS_DIAG_COMPLICATIONS.DT_CREATE IS 'Date when the complication was created';
COMMENT ON COLUMN EPIS_DIAG_COMPLICATIONS.ID_PROF_UPD IS 'Professional who updated the complication';
COMMENT ON COLUMN EPIS_DIAG_COMPLICATIONS.DT_UPD IS 'Date when the complication was updated';
COMMENT ON COLUMN EPIS_DIAG_COMPLICATIONS.RANK IS 'Rank of the complication within the epis_diagnosis';
------------------------------------------------------------------------------------------
COMMENT ON COLUMN EPIS_DIAG_COMPLICATIONS.CREATE_USER IS 'Create User';
COMMENT ON COLUMN EPIS_DIAG_COMPLICATIONS.CREATE_TIME IS 'Create Time';
COMMENT ON COLUMN EPIS_DIAG_COMPLICATIONS.CREATE_INSTITUTION IS 'Create Institution';
COMMENT ON COLUMN EPIS_DIAG_COMPLICATIONS.UPDATE_USER IS 'Update User';
COMMENT ON COLUMN EPIS_DIAG_COMPLICATIONS.UPDATE_TIME IS 'Update Time';
COMMENT ON COLUMN EPIS_DIAG_COMPLICATIONS.UPDATE_INSTITUTION IS 'Update Institution';

-- CHANGED BY: Lillian Lu
-- CHANGE DATE: 2018-05-21
-- CHANGE REASON: [CEMR-748] Complication description is not correct
DECLARE
    l_sql VARCHAR2(1000 CHAR);
BEGIN
    l_sql := 'ALTER TABLE EPIS_DIAG_COMPLICATIONS ADD (DESC_COMPLICATION VARCHAR2(200 CHAR))';
    pk_versioning.run(l_sql);
EXCEPTION
    WHEN OTHERS THEN
        dbms_output.put_line('WARNING: alter error.');
END;
/

COMMENT ON COLUMN EPIS_DIAG_COMPLICATIONS.DESC_COMPLICATION IS 'Complication description';
-- CHANGE END: Lillian Lu