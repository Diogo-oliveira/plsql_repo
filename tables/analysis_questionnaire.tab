  CREATE TABLE "ALERT"."ANALYSIS_QUESTIONNAIRE" 
(	"ID_ANALYSIS_QUESTIONNAIRE" NUMBER(24,0),  
	"ID_ANALYSIS" NUMBER(12,0),  
	"DESC_QUESTIONNAIRE" VARCHAR2(4000),  
	"DESC_VALUES" VARCHAR2(4000),
	"CODE_QUESTIONNAIRE" VARCHAR2(4000),  
	"FLG_ACTIVE" VARCHAR2(1), 
	"ID_ANALYSIS_ROOM" NUMBER(24,0) 
) ;


-- Para adicionar colunas pode ser usado código comentado
-- De momento só são suportados os tipos de dados mais comuns. 
-- ALTER TABLE ANALYSIS_QUESTIONNAIRE ADD ID_ANALYSIS_QUESTIONNAIRE NUMBER(24,0) NOT NULL;
-- ALTER TABLE ANALYSIS_QUESTIONNAIRE ADD ID_ANALYSIS NUMBER(12,0) NOT NULL;  
-- ALTER TABLE ANALYSIS_QUESTIONNAIRE ADD DESC_QUESTIONNAIRE VARCHAR2(4000) NOT NULL;  
-- ALTER TABLE ANALYSIS_QUESTIONNAIRE ADD DESC_VALUES VARCHAR2(4000) ;  
-- ALTER TABLE ANALYSIS_QUESTIONNAIRE ADD CODE_QUESTIONNAIRE VARCHAR2(4000) NOT NULL;  
-- ALTER TABLE ANALYSIS_QUESTIONNAIRE ADD FLG_ACTIVE VARCHAR2(1) NOT NULL; 
-- ALTER TABLE ANALYSIS_QUESTIONNAIRE ADD ID_ANALYSIS_ROOM NUMBER(24,0) NOT NULL;

COMMENT ON COLUMN "ALERT"."ANALYSIS_QUESTIONNAIRE"."ID_ANALYSIS_QUESTIONNAIRE" IS 'Primary Key';

COMMENT ON COLUMN "ALERT"."ANALYSIS_QUESTIONNAIRE"."ID_ANALYSIS" IS 'Analysis Id';  

COMMENT ON COLUMN "ALERT"."ANALYSIS_QUESTIONNAIRE"."DESC_QUESTIONNAIRE" IS 'Question'; 

COMMENT ON COLUMN "ALERT"."ANALYSIS_QUESTIONNAIRE"."DESC_VALUES" IS 'Possible answer values (free text)';

COMMENT ON COLUMN "ALERT"."ANALYSIS_QUESTIONNAIRE"."CODE_QUESTIONNAIRE" IS 'Abreviature Desc.'; 

COMMENT ON COLUMN "ALERT"."ANALYSIS_QUESTIONNAIRE"."FLG_ACTIVE" IS 'Active Y/N'; 

COMMENT ON COLUMN "ALERT"."ANALYSIS_QUESTIONNAIRE"."ID_ANALYSIS_ROOM" IS 'Laboratory'; 

ALTER TABLE analysis_questionnaire add id_room NUMBER(24);
COMMENT ON COLUMN "ALERT"."ANALYSIS_QUESTIONNAIRE"."ID_ROOM" IS 'Laboratory'; 

-- CHANGED BY: MARCO FREIRE
-- CHANGE DATE: 21/06/2010 15:14
-- CHANGE REASON: [ALERT-27380] 
ALTER TABLE ANALYSIS_QUESTIONNAIRE ADD FLG_TIMING VARCHAR2(1) DEFAULT 'O';
ALTER TABLE ANALYSIS_QUESTIONNAIRE DROP (DESC_QUESTIONNAIRE, DESC_VALUES, CODE_QUESTIONNAIRE, ID_ROOM);
ALTER TABLE ANALYSIS_QUESTIONNAIRE ADD ID_ROOM_QUESTIONNAIRE NUMBER(24);
ALTER TABLE ANALYSIS_QUESTIONNAIRE ADD ID_ANALYSIS_ROOM NUMBER(24);
ALTER TABLE ANALYSIS_QUESTIONNAIRE DROP (ID_ANALYSIS);
-- CHANGED END: MARCO FREIRE

-- CHANGED BY: Ana Matos
-- CHANGE DATE: 03/12/2012 14:57
-- CHANGE REASON: [ALERT-246252] 
ALTER TABLE analysis_questionnaire MODIFY (ID_SAMPLE_TYPE NUMBER(12) NOT NULL);
-- CHANGE END: Ana Matos

-- CHANGED BY: Ana Matos
-- CHANGE DATE: 03/12/2012 17:11
-- CHANGE REASON: [ALERT-246248] 
ALTER TABLE ANALYSIS_QUESTIONNAIRE ADD (ID_SAMPLE_TYPE NUMBER(12));

COMMENT ON TABLE ANALYSIS_QUESTIONNAIRE IS 'Table that defines the questionnaires for each lab test';

COMMENT ON COLUMN ANALYSIS_QUESTIONNAIRE.ID_SAMPLE_TYPE IS 'Sample type id';
-- CHANGE END: Ana Matos

-- CHANGED BY: Ana Matos
-- CHANGE DATE: 09/10/2013 10:05
-- CHANGE REASON: [ALERT-266573] 
ALTER TABLE ANALYSIS_QUESTIONNAIRE 
 ADD (ID_ANALYSIS_GROUP NUMBER(24)
 ,ID_RESPONSE NUMBER(24)
 ,FLG_TYPE VARCHAR2(2 CHAR)
 ,FLG_MANDATORY VARCHAR2(1 CHAR)
 ,FLG_COPY VARCHAR2(1 CHAR)
 ,FLG_VALIDATION VARCHAR2(1 CHAR)
 ,FLG_EXTERIOR VARCHAR2(1 CHAR)
 ,ID_UNIT_MEASURE NUMBER(24)
 ,ID_INSTITUTION NUMBER(24))
 MODIFY (ID_ANALYSIS NUMBER(24) NULL
 ,ID_ROOM NUMBER(24) NULL);

COMMENT ON COLUMN ANALYSIS_QUESTIONNAIRE.ID_ANALYSIS_QUESTIONNAIRE IS 'Primary key';
COMMENT ON COLUMN ANALYSIS_QUESTIONNAIRE.ID_ANALYSIS IS 'Lab test ID';
COMMENT ON COLUMN ANALYSIS_QUESTIONNAIRE.ID_SAMPLE_TYPE IS 'Sample type ID';
COMMENT ON COLUMN ANALYSIS_QUESTIONNAIRE.ID_ANALYSIS_GROUP IS 'Lab tests'' group ID';
COMMENT ON COLUMN ANALYSIS_QUESTIONNAIRE.ID_QUESTIONNAIRE IS 'Questionnaire ID';
COMMENT ON COLUMN ANALYSIS_QUESTIONNAIRE.ID_RESPONSE IS 'Response ID';
COMMENT ON COLUMN ANALYSIS_QUESTIONNAIRE.FLG_TIME IS 'Flag that indicates WHEN the questionnaire is to be answered';
COMMENT ON COLUMN ANALYSIS_QUESTIONNAIRE.FLG_TYPE IS 'Flag that indicates which type of input a  question will have (N - Number; N - Number with Unit measure; MI - Inclusive Multichoice; ME - Exclusive Multichoice; D - Date; DF - Future Date; DP - Past Date; T - Free text)';
COMMENT ON COLUMN ANALYSIS_QUESTIONNAIRE.FLG_MANDATORY IS 'Flag that indicates if the question is mandatory or not: Y - Yes; N - No';
COMMENT ON COLUMN ANALYSIS_QUESTIONNAIRE.FLG_COPY IS 'Flag that indicates if an answer can be copied to the same questions';
COMMENT ON COLUMN ANALYSIS_QUESTIONNAIRE.FLG_VALIDATION IS 'Flag that indicates if an answer is valide through out the episode for the same questions';
COMMENT ON COLUMN ANALYSIS_QUESTIONNAIRE.FLG_EXTERIOR IS 'Flag that indicates if a questionnaire is to be answered if the lab test is to be performed outside the facility';
COMMENT ON COLUMN ANALYSIS_QUESTIONNAIRE.ID_UNIT_MEASURE IS 'Unit measure ID';
COMMENT ON COLUMN ANALYSIS_QUESTIONNAIRE.ID_INSTITUTION IS 'Institution ID';
 
-- CHANGE END: Ana Matos

-- CHANGED BY: Ana Matos
-- CHANGE DATE: 09/10/2013 10:47
-- CHANGE REASON: [ALERT-266575] 
ALTER TABLE ANALYSIS_QUESTIONNAIRE 
 MODIFY (ID_RESPONSE NUMBER(24) NOT NULL
 ,FLG_TYPE VARCHAR2(2 CHAR) NOT NULL
 ,FLG_MANDATORY VARCHAR2(1 CHAR) NOT NULL
 ,FLG_COPY VARCHAR2(1 CHAR) NOT NULL
 ,FLG_VALIDATION VARCHAR2(1 CHAR) NOT NULL
 ,FLG_EXTERIOR VARCHAR2(1 CHAR) NOT NULL
 ,RANK NUMBER(6) NOT NULL
 ,ID_INSTITUTION NUMBER(24) NOT NULL
 ,CREATE_USER VARCHAR2(24 CHAR)
 ,UPDATE_USER VARCHAR2(24 CHAR));
 
-- CHANGE END: Ana Matos

-- CHANGED BY: Ana Matos
-- CHANGE DATE: 10/10/2014 11:11
-- CHANGE REASON: [ALERT-298206] 
DECLARE
    e_already_null EXCEPTION;

    PRAGMA EXCEPTION_INIT(e_already_null, -01451);
BEGIN
    BEGIN
        EXECUTE IMMEDIATE 'ALTER TABLE analysis_questionnaire modify(id_sample_type NUMBER(12) NULL)';
    EXCEPTION
        WHEN e_already_null THEN
            dbms_output.put_line('AVISO: Operação já executada anteriormente.');
    END;
END;
/
-- CHANGE END: Ana Matos

-- CHANGED BY: Ana Matos
-- CHANGE DATE: 08/01/2016 12:00
-- CHANGE REASON: [ALERT-317702] 
COMMENT ON COLUMN ANALYSIS_QUESTIONNAIRE.ID_ROOM IS 'Room ID';
-- CHANGE END: Ana Matos