-- CHANGED BY: Ana Monteiro
-- CHANGE DATE: 25/06/2012 17:09
-- CHANGE REASON: [ALERT-233961] 
DECLARE
    l_count PLS_INTEGER;
BEGIN
    SELECT COUNT(1)
      INTO l_count
      FROM user_tables u
     WHERE u.table_name = 'REF_MIG_INST_DEST';

    IF l_count = 0
    THEN
        EXECUTE IMMEDIATE q'[CREATE TABLE REF_MIG_INST_DEST
 (ID_EXTERNAL_REQUEST NUMBER(24) NOT NULL
 ,ID_INST_DEST_NEW NUMBER(24) NOT NULL
 ,FLG_RESULT VARCHAR2(1 CHAR) NOT NULL
 ,DT_CREATE TIMESTAMP WITH LOCAL TIME ZONE NOT NULL
 ,ERROR_DESC VARCHAR2(4000 CHAR)
 ,CREATE_USER VARCHAR2(30 CHAR)
 ,CREATE_TIME TIMESTAMP WITH LOCAL TIME ZONE
 ,CREATE_INSTITUTION NUMBER(24)
 ,UPDATE_USER VARCHAR2(30 CHAR)
 ,UPDATE_TIME TIMESTAMP WITH LOCAL TIME ZONE
 ,UPDATE_INSTITUTION NUMBER(24)
 )]';
    
        EXECUTE IMMEDIATE 'COMMENT ON TABLE REF_MIG_INST_DEST IS ''Table containing referrals that were migrated (dest institution)''';
        EXECUTE IMMEDIATE 'COMMENT ON COLUMN REF_MIG_INST_DEST.ID_EXTERNAL_REQUEST IS ''Referral identifier''';
        EXECUTE IMMEDIATE 'COMMENT ON COLUMN REF_MIG_INST_DEST.ID_INST_DEST_NEW IS ''Destination institution identifier''';
        EXECUTE IMMEDIATE 'COMMENT ON COLUMN REF_MIG_INST_DEST.FLG_RESULT IS ''Flag indicating if migration was successful or not: S - successful, U - unsuccessful''';
        EXECUTE IMMEDIATE 'COMMENT ON COLUMN REF_MIG_INST_DEST.DT_CREATE IS ''Migration date''';
        EXECUTE IMMEDIATE 'COMMENT ON COLUMN REF_MIG_INST_DEST.ERROR_DESC IS ''Error occured when migrating the referral''';
        EXECUTE IMMEDIATE 'COMMENT ON COLUMN REF_MIG_INST_DEST.CREATE_USER IS ''Creation User''';
        EXECUTE IMMEDIATE 'COMMENT ON COLUMN REF_MIG_INST_DEST.CREATE_TIME IS ''Creation Time''';
        EXECUTE IMMEDIATE 'COMMENT ON COLUMN REF_MIG_INST_DEST.CREATE_INSTITUTION IS ''Creation Institution''';
        EXECUTE IMMEDIATE 'COMMENT ON COLUMN REF_MIG_INST_DEST.UPDATE_USER IS ''Update User''';
        EXECUTE IMMEDIATE 'COMMENT ON COLUMN REF_MIG_INST_DEST.UPDATE_TIME IS ''Update Time''';
        EXECUTE IMMEDIATE 'COMMENT ON COLUMN REF_MIG_INST_DEST.UPDATE_INSTITUTION IS ''Update Institution''';
    END IF;

END;
/
-- CHANGE END: Ana Monteiro