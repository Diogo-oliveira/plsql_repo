-- CHANGED BY: Joana Barroso
-- CHANGE DATE: 26/11/2013 15:05
-- CHANGE REASON: [ALERT-268769 ] 
begin
pk_versioning.run(i_sql => 
'CREATE TABLE REF_COMMENTS
 (ID_REF_COMMENT NUMBER(24) NOT NULL,
 ID_EXTERNAL_REQUEST NUMBER(24) NOT NULL,
 FLG_TYPE VARCHAR2(1 char) NOT NULL,
 ID_PROFESSIONAL NUMBER(24) NOT NULL,
 ID_INSTITUTION NUMBER(24) NOT NULL,
 ID_SOFTWARE number(24),
 FLG_STATUS VARCHAR2( 1 char) NOT NULL, 
 DT_COMMENT TIMESTAMP WITH LOCAL TIME ZONE NOT NULL,
 DT_COMMENT_CANCELED TIMESTAMP  WITH LOCAL TIME ZONE,
 ID_INSTITUTION_CANCELED NUMBER(24),
 DT_COMMENT_OUTDATED TIMESTAMP  WITH  LOCAL TIME ZONE,
 ID_INSTITUTION_OUTDATED NUMBER(24),
 CREATE_USER NUMBER(24),
 CREATE_TIME TIMESTAMP WITH LOCAL TIME ZONE,
 CREATE_INSTITUTION NUMBER(24),
 UPDATE_USER NUMBER(24),
 UPDATE_TIME TIMESTAMP WITH LOCAL TIME ZONE,
 UPDATE_INSTITUTION NUMBER(24))');
end;
/

COMMENT ON TABLE REF_COMMENTS IS 'Table with referral comments';
COMMENT ON COLUMN REF_COMMENTS.ID_REF_COMMENT IS 'Referral comment ID';
COMMENT ON COLUMN REF_COMMENTS.ID_EXTERNAL_REQUEST IS 'Referral Id';
COMMENT ON COLUMN REF_COMMENTS.FLG_TYPE IS 'Type of comment (''C''linical, ''A''dministrative)';
COMMENT ON COLUMN REF_COMMENTS.FLG_STATUS IS 'Comment status ''(A)ctive; (O)utdated; (C)anceled)';
COMMENT ON COLUMN REF_COMMENTS.ID_PROFESSIONAL IS 'Professional who created the comment';
COMMENT ON COLUMN REF_COMMENTS.ID_INSTITUTION IS 'Institution where the comment was created';
COMMENT ON COLUMN REF_COMMENTS.ID_SOFTWARE IS 'Software where the comment was created';
COMMENT ON COLUMN REF_COMMENTS.DT_COMMENT IS 'Date of comment insert';
COMMENT ON COLUMN REF_COMMENTS.DT_COMMENT_CANCELED IS 'Date of comment cancelation';
COMMENT ON COLUMN REF_COMMENTS.ID_INSTITUTION_CANCELED IS 'Institution where comment was canceled';
COMMENT ON COLUMN REF_COMMENTS.DT_COMMENT_OUTDATED IS 'Date when comment was outdated';
COMMENT ON COLUMN REF_COMMENTS.ID_INSTITUTION_OUTDATED IS 'Institution where comment was outdated';
COMMENT ON COLUMN REF_COMMENTS.CODE_REF_COMMENTS IS 'Virtual column (Code_translation of translation_trs)';
COMMENT ON COLUMN REF_COMMENTS.CREATE_USER IS 'Creation User';
COMMENT ON COLUMN REF_COMMENTS.CREATE_TIME IS 'Creation Time';
COMMENT ON COLUMN REF_COMMENTS.CREATE_INSTITUTION IS 'Creation Institution';
COMMENT ON COLUMN REF_COMMENTS.UPDATE_USER IS 'Update User';
COMMENT ON COLUMN REF_COMMENTS.UPDATE_TIME IS 'Update Time';
COMMENT ON COLUMN REF_COMMENTS.UPDATE_INSTITUTION IS 'Update Institution';
-- CHANGE END: Joana Barroso

-- CHANGED BY: Joana Barroso
-- CHANGE DATE: 26/11/2013 16:05
-- CHANGE REASON: [ALERT-270542 ] 
begin
pk_versioning.run(i_sql => 
'CREATE TABLE REF_COMMENTS
 (ID_REF_COMMENT NUMBER(24) NOT NULL,
 ID_EXTERNAL_REQUEST NUMBER(24) NOT NULL,
 FLG_TYPE VARCHAR2(1 char) NOT NULL,
 ID_PROFESSIONAL NUMBER(24) NOT NULL,
 ID_INSTITUTION NUMBER(24) NOT NULL,
 ID_SOFTWARE number(24),
 FLG_STATUS VARCHAR2( 1 char) NOT NULL, 
 DT_COMMENT TIMESTAMP WITH LOCAL TIME ZONE NOT NULL,
 DT_COMMENT_CANCELED TIMESTAMP  WITH LOCAL TIME ZONE,
 ID_INSTITUTION_CANCELED NUMBER(24),
 DT_COMMENT_OUTDATED TIMESTAMP  WITH  LOCAL TIME ZONE,
 ID_INSTITUTION_OUTDATED NUMBER(24),
 CREATE_USER NUMBER(24),
 CREATE_TIME TIMESTAMP WITH LOCAL TIME ZONE,
 CREATE_INSTITUTION NUMBER(24),
 UPDATE_USER NUMBER(24),
 UPDATE_TIME TIMESTAMP WITH LOCAL TIME ZONE,
 UPDATE_INSTITUTION NUMBER(24))');
end;
/

COMMENT ON TABLE REF_COMMENTS IS 'Table with referral comments';
COMMENT ON COLUMN REF_COMMENTS.ID_REF_COMMENT IS 'Referral comment ID';
COMMENT ON COLUMN REF_COMMENTS.ID_EXTERNAL_REQUEST IS 'Referral Id';
COMMENT ON COLUMN REF_COMMENTS.FLG_TYPE IS 'Type of comment (''C''linical, ''A''dministrative)';
COMMENT ON COLUMN REF_COMMENTS.FLG_STATUS IS 'Comment status ''(A)ctive; (O)utdated; (C)anceled)';
COMMENT ON COLUMN REF_COMMENTS.ID_PROFESSIONAL IS 'Professional who created the comment';
COMMENT ON COLUMN REF_COMMENTS.ID_INSTITUTION IS 'Institution where the comment was created';
COMMENT ON COLUMN REF_COMMENTS.ID_SOFTWARE IS 'Software where the comment was created';
COMMENT ON COLUMN REF_COMMENTS.DT_COMMENT IS 'Date of comment insert';
COMMENT ON COLUMN REF_COMMENTS.DT_COMMENT_CANCELED IS 'Date of comment cancelation';
COMMENT ON COLUMN REF_COMMENTS.ID_INSTITUTION_CANCELED IS 'Institution where comment was canceled';
COMMENT ON COLUMN REF_COMMENTS.DT_COMMENT_OUTDATED IS 'Date when comment was outdated';
COMMENT ON COLUMN REF_COMMENTS.ID_INSTITUTION_OUTDATED IS 'Institution where comment was outdated';
COMMENT ON COLUMN REF_COMMENTS.CODE_REF_COMMENTS IS 'Virtual column (Code_translation of translation_trs)';
COMMENT ON COLUMN REF_COMMENTS.CREATE_USER IS 'Creation User';
COMMENT ON COLUMN REF_COMMENTS.CREATE_TIME IS 'Creation Time';
COMMENT ON COLUMN REF_COMMENTS.CREATE_INSTITUTION IS 'Creation Institution';
COMMENT ON COLUMN REF_COMMENTS.UPDATE_USER IS 'Update User';
COMMENT ON COLUMN REF_COMMENTS.UPDATE_TIME IS 'Update Time';
COMMENT ON COLUMN REF_COMMENTS.UPDATE_INSTITUTION IS 'Update Institution';
-- CHANGE END: Joana Barroso

-- CHANGED BY: Joana Barroso
-- CHANGE DATE: 26/11/2013 16:45
-- CHANGE REASON: [ALERT-270542] 
BEGIN
    pk_versioning.run(i_sql => 'alter table REF_COMMENTS add(
CODE_REF_COMMENTS as ("PK_REF_CORE_INTERNAL"."GET_CODE_REF_COMMENTS"("ID_REF_COMMENT")))');
END;
/
-- CHANGE END: Joana Barroso

-- CHANGED BY: Joao Sa
-- ISSUE: ALERT-317695 Database model documentation and comments corretions
comment on table REF_COMMENTS
  is 'Referral comments';
-- Add comments to the columns 
comment on column REF_COMMENTS.code_ref_comments
  is 'Identifier for the comment text in translation_trs';
