

  CREATE TABLE "ALERT"."EXAM_RESULT_HIST"
   (	"DT_EXAM_RESULT_HIST" TIMESTAMP (6) WITH LOCAL TIME ZONE,
	"ID_EXAM_RESULT" NUMBER(24,0),
	"ID_EXAM" NUMBER(24,0),
	"ID_EXAM_REQ_DET" NUMBER(24,0),
	"ID_PROFESSIONAL" NUMBER(24,0),
	"ID_PATIENT" NUMBER(24,0),
	"NOTES" CLOB,
	"FLG_TYPE" VARCHAR2(1),
	"ID_INSTITUTION" NUMBER(24,0),
	"ID_PROF_MOV_BEGIN" NUMBER(24,0),
	"ID_PROF_MOV_END" NUMBER(24,0),
	"ID_EPISODE" NUMBER(24,0),
	"ID_EPISODE_WRITE" NUMBER(24,0),
	"DT_EXAM_RESULT_TSTZ" TIMESTAMP (6) WITH LOCAL TIME ZONE,
	"DT_MOV_BEGIN_TSTZ" TIMESTAMP (6) WITH LOCAL TIME ZONE,
	"DT_MOV_END_TSTZ" TIMESTAMP (6) WITH LOCAL TIME ZONE,
	"ID_EXTERNAL_DOC" NUMBER,
	"FLG_STATUS" VARCHAR2(1) DEFAULT 'A',
	"DT_EXAM_RESULT_CANCEL_TSTZ" TIMESTAMP (6) WITH LOCAL TIME ZONE,
	"ID_PROF_CANCEL" NUMBER(24,0),
	"FLG_RESULT_ORIGIN" VARCHAR2(2),
	"CREATE_USER" VARCHAR2(24),
	"CREATE_TIME" TIMESTAMP (6) WITH LOCAL TIME ZONE,
	"CREATE_INSTITUTION" NUMBER(24,0),
	"UPDATE_USER" VARCHAR2(24),
	"UPDATE_TIME" TIMESTAMP (6) WITH LOCAL TIME ZONE,
	"UPDATE_INSTITUTION" NUMBER(24,0)
   ) ;


-- Para adicionar colunas pode ser usado código comentado
-- De momento só são suportados os tipos de dados mais comuns.
-- ALTER TABLE EXAM_RESULT_HIST ADD DT_EXAM_RESULT_HIST TIMESTAMP(6) WITH LOCAL TIME ZONE NOT NULL;
-- ALTER TABLE EXAM_RESULT_HIST ADD ID_EXAM_RESULT NUMBER(24,0) NOT NULL;
-- ALTER TABLE EXAM_RESULT_HIST ADD ID_EXAM NUMBER(24,0) NOT NULL;
-- ALTER TABLE EXAM_RESULT_HIST ADD ID_EXAM_REQ_DET NUMBER(24,0) NOT NULL;
-- ALTER TABLE EXAM_RESULT_HIST ADD ID_PROFESSIONAL NUMBER(24,0) NOT NULL;
-- ALTER TABLE EXAM_RESULT_HIST ADD ID_PATIENT NUMBER(24,0) NOT NULL;
-- ALTER TABLE EXAM_RESULT_HIST ADD NOTES CLOB(******ERROR) ;
-- ALTER TABLE EXAM_RESULT_HIST ADD FLG_TYPE VARCHAR2(1) NOT NULL;
-- ALTER TABLE EXAM_RESULT_HIST ADD ID_INSTITUTION NUMBER(24,0) ;
-- ALTER TABLE EXAM_RESULT_HIST ADD ID_PROF_MOV_BEGIN NUMBER(24,0) ;
-- ALTER TABLE EXAM_RESULT_HIST ADD ID_PROF_MOV_END NUMBER(24,0) ;
-- ALTER TABLE EXAM_RESULT_HIST ADD ID_EPISODE NUMBER(24,0) ;
-- ALTER TABLE EXAM_RESULT_HIST ADD ID_EPISODE_WRITE NUMBER(24,0) ;
-- ALTER TABLE EXAM_RESULT_HIST ADD DT_EXAM_RESULT_TSTZ TIMESTAMP(6) WITH LOCAL TIME ZONE ;
-- ALTER TABLE EXAM_RESULT_HIST ADD DT_MOV_BEGIN_TSTZ TIMESTAMP(6) WITH LOCAL TIME ZONE ;
-- ALTER TABLE EXAM_RESULT_HIST ADD DT_MOV_END_TSTZ TIMESTAMP(6) WITH LOCAL TIME ZONE ;
-- ALTER TABLE EXAM_RESULT_HIST ADD ID_EXTERNAL_DOC NUMBER ;
-- ALTER TABLE EXAM_RESULT_HIST ADD FLG_STATUS VARCHAR2(1) ;
-- ALTER TABLE EXAM_RESULT_HIST ADD DT_EXAM_RESULT_CANCEL_TSTZ TIMESTAMP(6) WITH LOCAL TIME ZONE ;
-- ALTER TABLE EXAM_RESULT_HIST ADD ID_PROF_CANCEL NUMBER(24,0) ;
-- ALTER TABLE EXAM_RESULT_HIST ADD FLG_RESULT_ORIGIN VARCHAR2(2) ;
-- ALTER TABLE EXAM_RESULT_HIST ADD CREATE_USER VARCHAR2(24) ;
-- ALTER TABLE EXAM_RESULT_HIST ADD CREATE_TIME TIMESTAMP(6) WITH LOCAL TIME ZONE ;
-- ALTER TABLE EXAM_RESULT_HIST ADD CREATE_INSTITUTION NUMBER(24,0) ;
-- ALTER TABLE EXAM_RESULT_HIST ADD UPDATE_USER VARCHAR2(24) ;
-- ALTER TABLE EXAM_RESULT_HIST ADD UPDATE_TIME TIMESTAMP(6) WITH LOCAL TIME ZONE ;
-- ALTER TABLE EXAM_RESULT_HIST ADD UPDATE_INSTITUTION NUMBER(24,0) ;

   COMMENT ON COLUMN "ALERT"."EXAM_RESULT_HIST"."DT_EXAM_RESULT_HIST" IS 'Data do registo na tabela';



   COMMENT ON COLUMN "ALERT"."EXAM_RESULT_HIST"."ID_EXAM_RESULT" IS 'Id do resultado';



   COMMENT ON COLUMN "ALERT"."EXAM_RESULT_HIST"."ID_EXAM" IS 'Id do exame';



   COMMENT ON COLUMN "ALERT"."EXAM_RESULT_HIST"."ID_EXAM_REQ_DET" IS 'Id do detalhe da requisição';



   COMMENT ON COLUMN "ALERT"."EXAM_RESULT_HIST"."ID_PROFESSIONAL" IS 'Id do profissional';



   COMMENT ON COLUMN "ALERT"."EXAM_RESULT_HIST"."ID_PATIENT" IS 'Id do paciente';



   COMMENT ON COLUMN "ALERT"."EXAM_RESULT_HIST"."NOTES" IS 'Resultado do exame';



   COMMENT ON COLUMN "ALERT"."EXAM_RESULT_HIST"."FLG_TYPE" IS 'Registado por: D - médico; T - técnico';



   COMMENT ON COLUMN "ALERT"."EXAM_RESULT_HIST"."ID_INSTITUTION" IS 'Id da instituição onde o registo foi introduzido';



   COMMENT ON COLUMN "ALERT"."EXAM_RESULT_HIST"."ID_PROF_MOV_BEGIN" IS 'Profissional que transporta os resultados de imagem ao requisitante';



   COMMENT ON COLUMN "ALERT"."EXAM_RESULT_HIST"."ID_PROF_MOV_END" IS 'Profissional que recebe os resultados de imagem';



   COMMENT ON COLUMN "ALERT"."EXAM_RESULT_HIST"."ID_EPISODE" IS 'ID do episódio em que foram lidos os resultados, pelo requisitante';



   COMMENT ON COLUMN "ALERT"."EXAM_RESULT_HIST"."ID_EPISODE_WRITE" IS 'ID do episódio em que o resultado foi registado';



   COMMENT ON COLUMN "ALERT"."EXAM_RESULT_HIST"."DT_EXAM_RESULT_TSTZ" IS 'Data do resultado';



   COMMENT ON COLUMN "ALERT"."EXAM_RESULT_HIST"."DT_MOV_BEGIN_TSTZ" IS 'Data do transporte dos resultados do exame';



   COMMENT ON COLUMN "ALERT"."EXAM_RESULT_HIST"."DT_MOV_END_TSTZ" IS 'Data da recepção dos resultados do exame';



   COMMENT ON COLUMN "ALERT"."EXAM_RESULT_HIST"."ID_EXTERNAL_DOC" IS 'Id da tabela de dados externos que nao têm interface completo, como os ECG';



   COMMENT ON COLUMN "ALERT"."EXAM_RESULT_HIST"."FLG_STATUS" IS 'Flag que indica o estado do resultado : A - Activo; C - Cancelado';



   COMMENT ON COLUMN "ALERT"."EXAM_RESULT_HIST"."DT_EXAM_RESULT_CANCEL_TSTZ" IS 'Data do cancelmento do resultado do exame';



   COMMENT ON COLUMN "ALERT"."EXAM_RESULT_HIST"."ID_PROF_CANCEL" IS 'Id do profissional que cancelou o resultado';



   COMMENT ON COLUMN "ALERT"."EXAM_RESULT_HIST"."FLG_RESULT_ORIGIN" IS 'Flag que indica a origem do resultado do exame';




-- CHANGED BY: Carlos Nogueira
-- CHANGE DATE: 02/06/2010 09:52
-- CHANGE REASON: [ALERT-14490] Adicao de nova coluna na exam_result_hist

ALTER TABLE exam_result_hist
  ADD (ID_RESULT_STATUS NUMBER(24)); 
/

comment on column exam_result_hist.ID_RESULT_STATUS IS 'Result Status ID';
/
-- CHANGE END: Carlos Nogueira

-- CHANGED BY: Ana Matos
-- CHANGE DATE: 16/02/2011 12:15
-- CHANGE REASON: [ALERT-41171] 
alter table exam_result_hist rename column notes to notes_old;

alter table exam_result_hist add (notes clob);
-- CHANGE END: Ana Matos

-- CHANGED BY: Ana Matos
-- CHANGE DATE: 27/09/2011 16:31
-- CHANGE REASON: [ALERT-181875] 
ALTER TABLE EXAM_RESULT_HIST ADD (ID_CANCEL_REASON NUMBER(24), NOTES_CANCEL CLOB);

COMMENT ON COLUMN EXAM_RESULT_HIST.ID_CANCEL_REASON IS 'Cancel reason id';
COMMENT ON COLUMN EXAM_RESULT_HIST.NOTES_CANCEL IS 'Cancellation notes';
-- CHANGE END: Ana Matos

-- CHANGE BY: Vanessa Barsottelli
-- CHANGE DATE: 01/03/2012 09:34
-- CHANGE REASON: [ALERT-221190]
ALTER TABLE EXAM_RESULT_HIST ADD ID_RESULT_NOTES NUMBER(24,0);
ALTER TABLE EXAM_RESULT_HIST ADD NOTES_RESULT CLOB;
ALTER TABLE EXAM_RESULT_HIST ADD ID_PROF_READ NUMBER(24,0);
ALTER TABLE EXAM_RESULT_HIST ADD DT_PROF_READ_TSTZ TIMESTAMP WITH LOCAL TIME ZONE;

COMMENT ON COLUMN EXAM_RESULT_HIST.ID_RESULT_NOTES IS 'Result notes ID';
COMMENT ON COLUMN EXAM_RESULT_HIST.NOTES_RESULT IS 'Result notes';
COMMENT ON COLUMN EXAM_RESULT_HIST.ID_PROF_READ IS 'Professional ID who marked the exam as read';
COMMENT ON COLUMN EXAM_RESULT_HIST.DT_PROF_READ_TSTZ IS 'Date when the professional marked the exam as read';
--CHANGE END: Vanessa Barsottelli

-- CHANGED BY: Ana Matos
-- CHANGE DATE: 26/10/2012 16:04
-- CHANGE REASON: [ALERT-243506] 
ALTER TABLE EXAM_RESULT_HIST ADD (ID_EXAM_RESULT_PARENT NUMBER(24));
ALTER TABLE EXAM_RESULT_HIST DROP COLUMN NOTES_OLD;
ALTER TABLE EXAM_RESULT_HIST MODIFY (ID_EXAM NUMBER(24) NULL);
ALTER TABLE EXAM_RESULT_HIST MODIFY CREATE_USER VARCHAR2(24 CHAR);
ALTER TABLE EXAM_RESULT_HIST MODIFY FLG_RESULT_ORIGIN VARCHAR2(2 CHAR);
ALTER TABLE EXAM_RESULT_HIST MODIFY FLG_STATUS VARCHAR2(1 CHAR);
ALTER TABLE EXAM_RESULT_HIST MODIFY FLG_TYPE VARCHAR2(1 CHAR);
ALTER TABLE EXAM_RESULT_HIST MODIFY UPDATE_USER VARCHAR2(24 CHAR);

COMMENT ON TABLE EXAM_RESULT_HIST IS 'Exams'' results history table';

COMMENT ON COLUMN EXAM_RESULT_HIST.ID_EXAM_RESULT_PARENT IS 'Id exam result parent (when there is one result for several exams)';
COMMENT ON COLUMN EXAM_RESULT_HIST.NOTES IS 'Resultado do exame';
COMMENT ON COLUMN EXAM_RESULT_HIST.ID_PROFESSIONAL IS 'Professional id';
COMMENT ON COLUMN EXAM_RESULT_HIST.CREATE_USER IS 'Creation User';
COMMENT ON COLUMN EXAM_RESULT_HIST.CREATE_TIME IS 'Creation Time';
COMMENT ON COLUMN EXAM_RESULT_HIST.CREATE_INSTITUTION IS 'Creation Institution';
COMMENT ON COLUMN EXAM_RESULT_HIST.UPDATE_USER IS 'Update User';
COMMENT ON COLUMN EXAM_RESULT_HIST.UPDATE_TIME IS 'Update Time';
COMMENT ON COLUMN EXAM_RESULT_HIST.UPDATE_INSTITUTION IS 'Update Institution';
-- CHANGE END: Ana Matos

-- CHANGED BY: Ana Matos
-- CHANGE DATE: 27/05/2013 17:35
-- CHANGE REASON: [ALERT-253722] 
ALTER TABLE EXAM_RESULT_HIST ADD (RESULT_ORIGIN_NOTES VARCHAR2(200));

COMMENT ON COLUMN EXAM_RESULT_HIST.RESULT_ORIGIN_NOTES IS 'Result origin notes';
-- CHANGE END: Ana Matos

-- CHANGED BY: Ana Matos
-- CHANGE DATE: 08/07/2013 16:38
-- CHANGE REASON: [ALERT-256653] 
ALTER TABLE EXAM_RESULT_HIST ADD (ID_ABNORMALITY NUMBER(24));

COMMENT ON COLUMN EXAM_RESULT_HIST.DT_EXAM_RESULT_HIST IS 'Date when the register was made';
COMMENT ON COLUMN EXAM_RESULT_HIST.ID_EXAM_RESULT IS 'Exams'' result ID';
COMMENT ON COLUMN EXAM_RESULT_HIST.ID_EXAM_RESULT_PARENT IS 'Exams'' result parent ID';
COMMENT ON COLUMN EXAM_RESULT_HIST.ID_EXAM_REQ_DET IS 'Exam''s order detail ID';
COMMENT ON COLUMN EXAM_RESULT_HIST.ID_EXAM IS 'Exam ID';
COMMENT ON COLUMN EXAM_RESULT_HIST.ID_PATIENT IS 'Patient ID';
COMMENT ON COLUMN EXAM_RESULT_HIST.ID_EPISODE_WRITE IS 'Episode ID';
COMMENT ON COLUMN EXAM_RESULT_HIST.ID_EPISODE IS 'Episode ID where the results where read';
COMMENT ON COLUMN EXAM_RESULT_HIST.ID_INSTITUTION IS 'Institution ID';
COMMENT ON COLUMN EXAM_RESULT_HIST.ID_PROFESSIONAL IS 'Professional that registers the result';
COMMENT ON COLUMN EXAM_RESULT_HIST.DT_EXAM_RESULT_TSTZ IS 'Date that indicates when the result was registered';
COMMENT ON COLUMN EXAM_RESULT_HIST.FLG_STATUS IS 'Flag that indicates the result''s status';
COMMENT ON COLUMN EXAM_RESULT_HIST.ID_RESULT_STATUS IS 'Result status ID';
COMMENT ON COLUMN EXAM_RESULT_HIST.ID_ABNORMALITY IS 'Abnormality level ID';
COMMENT ON COLUMN EXAM_RESULT_HIST.FLG_RESULT_ORIGIN IS 'Flag que indicates the result''s origin';
COMMENT ON COLUMN EXAM_RESULT_HIST.NOTES IS 'Exam''s result';
COMMENT ON COLUMN EXAM_RESULT_HIST.ID_EXTERNAL_DOC IS 'External doc ID';
COMMENT ON COLUMN EXAM_RESULT_HIST.FLG_TYPE IS 'Flag that indicates the category of the professional that registered the result';
COMMENT ON COLUMN EXAM_RESULT_HIST.ID_PROF_MOV_BEGIN IS 'Transportation professional';
COMMENT ON COLUMN EXAM_RESULT_HIST.ID_PROF_MOV_END IS 'Transportation receiving professional';
COMMENT ON COLUMN EXAM_RESULT_HIST.ID_PROF_READ IS 'Professional who marked the exam as read';
COMMENT ON COLUMN EXAM_RESULT_HIST.ID_PROF_CANCEL IS 'Professional that cancels the exam result';
COMMENT ON COLUMN EXAM_RESULT_HIST.DT_EXAM_RESULT_CANCEL_TSTZ IS 'Date that indicates when the exam result was cancelled';
COMMENT ON COLUMN EXAM_RESULT_HIST.ID_CANCEL_REASON IS 'Cancel reason ID';
COMMENT ON COLUMN EXAM_RESULT_HIST.NOTES_CANCEL IS 'Cancelation notes';
-- CHANGE END: Ana Matos

-- CHANGED BY: teresa.coutinho
-- CHANGE DATE: 25/11/2013 10:22
-- CHANGE REASON: [ALERT-268453 ] 
alter table EXAM_RESULT_HIST add id_epis_documentation NUMBER(24);
-- Add comments to the columns 
comment on column EXAM_RESULT_HIST.id_epis_documentation
  is 'Exam''s result documentation ID ';
-- CHANGE END: teresa.coutinho

-- CHANGED BY: Ana Matos
-- CHANGE DATE: 06/01/2016 17:52
-- CHANGE REASON: [ALERT-317702] 
COMMENT ON TABLE EXAM_RESULT_HIST IS 'Exams'' orders results history table';
-- CHANGE END: Ana Matos

-- CHANGED BY: Ana Matos
-- CHANGE DATE: 13/04/2017 11:33
-- CHANGE REASON: [ALERT-329997] 
ALTER TABLE EXAM_RESULT_HIST ADD (FLG_RELEVANT VARCHAR (1 CHAR));
COMMENT ON COLUMN EXAM_RESULT_HIST.FLG_RELEVANT IS 'Indication of the result''s relevance';
-- CHANGE END: Ana Matos

-- CHANGED BY: Pedro Henriques
-- CHANGE DATE: 09/07/2018 11:32
-- CHANGE REASON: [EMR-4796] 
DECLARE 
	l_sql VARCHAR2(1000 CHAR);
	l_sql_1 VARCHAR2(1000 CHAR);
	l_sql_2 VARCHAR2(1000 CHAR);
BEGIN
    l_sql := 'ALTER TABLE alert.exam_result_hist move lob(notes) store AS (tablespace alert_lob)';
    pk_versioning.run(l_sql);
	l_sql_1 := 'ALTER TABLE alert.exam_result_hist move lob(notes_result) store AS (tablespace alert_lob)';
    pk_versioning.run(l_sql_1);
	l_sql_2 := 'ALTER TABLE alert.exam_result_hist move lob(notes_cancel) store AS (tablespace alert_lob)';
    pk_versioning.run(l_sql_2);
EXCEPTION
    WHEN OTHERS THEN
        NULL;
END;
/
-- CHANGE END: Pedro Henriques