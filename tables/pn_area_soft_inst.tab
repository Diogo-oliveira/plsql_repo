-- CHANGED BY: Sofia Mendes
-- CHANGE DATE: 18/10/2011 09:28
-- CHANGE REASON: [ALERT-199724] H&P phase2
CREATE TABLE pn_area_soft_inst(id_pn_area NUMBER(24) NOT NULL, 
                     id_software NUMBER(24) NOT NULL, 
                     id_institution NUMBER(24) NOT NULL, 
                     id_department NUMBER(24) NOT NULL, 
                     id_dep_clin_serv NUMBER(24) NOT NULL,
                     NR_REC_PAGE_SUMMARY number(6) default 5, 
                     DATA_SORT_SUMMARY VARCHAR2(50 char) default 'DESC',
                     NR_REC_PAGE_HIST number(6) default 5,
                     FLG_REPORT_TITLE_TYPE varchar2(1 char) default 'B',
                     flg_available VARCHAR2(1 CHAR) DEFAULT 'Y',                      
                     create_user VARCHAR2(24),
                     create_time TIMESTAMP(6) WITH LOCAL TIME ZONE,
                     create_institution NUMBER(24),
                     update_user VARCHAR2(24),
                     update_time TIMESTAMP(6) WITH LOCAL TIME ZONE,
                     update_institution NUMBER(24));

COMMENT ON column pn_area_soft_inst.id_pn_area IS 'Area identifier';
COMMENT ON column pn_area_soft_inst.id_software IS 'Software identifier.';
COMMENT ON column pn_area_soft_inst.id_institution IS 'Institution identifier.';
COMMENT ON column pn_area_soft_inst.NR_REC_PAGE_SUMMARY IS 'Number of registries per page in the summary grid';
COMMENT ON column pn_area_soft_inst.DATA_SORT_SUMMARY IS 'Date sort in the summary grid. ASC-date ascending sort; DESC-date descending sort';
COMMENT ON column pn_area_soft_inst.NR_REC_PAGE_HIST IS 'Number of registries per page in the history screen';
COMMENT ON column pn_area_soft_inst.FLG_REPORT_TITLE_TYPE IS 'T ? In the complete report it is shown a title with the note date, status and nr of addendums. B ? It is not shown the title and the date it is shown as a soap block.';
COMMENT ON column pn_area_soft_inst.create_user IS 'Creation user';
COMMENT ON column pn_area_soft_inst.create_time IS 'Creation date / time';
COMMENT ON column pn_area_soft_inst.create_institution IS 'Creation institution';
COMMENT ON column pn_area_soft_inst.update_user IS 'Update user';
COMMENT ON column pn_area_soft_inst.update_time IS 'Update date / time';
COMMENT ON column pn_area_soft_inst.update_institution IS 'Update institution';
COMMENT ON column pn_area_soft_inst.id_department IS 'Department identifier.';
COMMENT ON column pn_area_soft_inst.id_dep_clin_serv IS 'Dep_clin_serv identifier.';
COMMENT ON column pn_area_soft_inst.flg_available IS 'Flag indicating if relational record is available';
-- CHANGE END: Sofia Mendes

-- CHANGED BY: Sofia Mendes
-- CHANGE DATE: 23/11/2011 09:58
-- CHANGE REASON: H&P phase2
CREATE TABLE pn_area_soft_inst(id_pn_area NUMBER(24) NOT NULL, 
                     id_software NUMBER(24) NOT NULL, 
                     id_institution NUMBER(24) NOT NULL, 
                     id_department NUMBER(24) NOT NULL, 
                     id_dep_clin_serv NUMBER(24) NOT NULL,
                     NR_REC_PAGE_SUMMARY number(6) default 5, 
                     DATA_SORT_SUMMARY VARCHAR2(50 char) default 'DESC',
                     NR_REC_PAGE_HIST number(6) default 5,
                     FLG_REPORT_TITLE_TYPE varchar2(1 char) default 'B',
                     flg_available VARCHAR2(1 CHAR) DEFAULT 'Y',                      
                     create_user VARCHAR2(24),
                     create_time TIMESTAMP(6) WITH LOCAL TIME ZONE,
                     create_institution NUMBER(24),
                     update_user VARCHAR2(24),
                     update_time TIMESTAMP(6) WITH LOCAL TIME ZONE,
                     update_institution NUMBER(24));

COMMENT ON column pn_area_soft_inst.id_pn_area IS 'Area identifier';
COMMENT ON column pn_area_soft_inst.id_software IS 'Software identifier.';
COMMENT ON column pn_area_soft_inst.id_institution IS 'Institution identifier.';
COMMENT ON column pn_area_soft_inst.NR_REC_PAGE_SUMMARY IS 'Number of registries per page in the summary grid';
COMMENT ON column pn_area_soft_inst.DATA_SORT_SUMMARY IS 'Date sort in the summary grid. ASC-date ascending sort; DESC-date descending sort';
COMMENT ON column pn_area_soft_inst.NR_REC_PAGE_HIST IS 'Number of registries per page in the history screen';
COMMENT ON column pn_area_soft_inst.FLG_REPORT_TITLE_TYPE IS 'T ? In the complete report it is shown a title with the note date, status and nr of addendums. B ? It is not shown the title and the date it is shown as a soap block.';
COMMENT ON column pn_area_soft_inst.create_user IS 'Creation user';
COMMENT ON column pn_area_soft_inst.create_time IS 'Creation date / time';
COMMENT ON column pn_area_soft_inst.create_institution IS 'Creation institution';
COMMENT ON column pn_area_soft_inst.update_user IS 'Update user';
COMMENT ON column pn_area_soft_inst.update_time IS 'Update date / time';
COMMENT ON column pn_area_soft_inst.update_institution IS 'Update institution';
COMMENT ON column pn_area_soft_inst.id_department IS 'Department identifier.';
COMMENT ON column pn_area_soft_inst.id_dep_clin_serv IS 'Dep_clin_serv identifier.';
COMMENT ON column pn_area_soft_inst.flg_available IS 'Flag indicating if relational record is available';
-- CHANGE END: Sofia Mendes

-- CHANGED BY: Sofia Mendes
-- CHANGE DATE: 23/11/2011 10:10
-- CHANGE REASON: [ALERT-206287 ] H&P phase2
CREATE TABLE pn_area_soft_inst(id_pn_area NUMBER(24) NOT NULL, 
                     id_software NUMBER(24) NOT NULL, 
                     id_institution NUMBER(24) NOT NULL, 
                     id_department NUMBER(24) NOT NULL, 
                     id_dep_clin_serv NUMBER(24) NOT NULL,
                     NR_REC_PAGE_SUMMARY number(6) default 5, 
                     DATA_SORT_SUMMARY VARCHAR2(50 char) default 'DESC',
                     NR_REC_PAGE_HIST number(6) default 5,
                     FLG_REPORT_TITLE_TYPE varchar2(1 char) default 'B',
                     flg_available VARCHAR2(1 CHAR) DEFAULT 'Y',                      
                     create_user VARCHAR2(24),
                     create_time TIMESTAMP(6) WITH LOCAL TIME ZONE,
                     create_institution NUMBER(24),
                     update_user VARCHAR2(24),
                     update_time TIMESTAMP(6) WITH LOCAL TIME ZONE,
                     update_institution NUMBER(24));

COMMENT ON column pn_area_soft_inst.id_pn_area IS 'Area identifier';
COMMENT ON column pn_area_soft_inst.id_software IS 'Software identifier.';
COMMENT ON column pn_area_soft_inst.id_institution IS 'Institution identifier.';
COMMENT ON column pn_area_soft_inst.NR_REC_PAGE_SUMMARY IS 'Number of registries per page in the summary grid';
COMMENT ON column pn_area_soft_inst.DATA_SORT_SUMMARY IS 'Date sort in the summary grid. ASC-date ascending sort; DESC-date descending sort';
COMMENT ON column pn_area_soft_inst.NR_REC_PAGE_HIST IS 'Number of registries per page in the history screen';
COMMENT ON column pn_area_soft_inst.FLG_REPORT_TITLE_TYPE IS 'T ? In the complete report it is shown a title with the note date, status and nr of addendums. B ? It is not shown the title and the date it is shown as a soap block.';
COMMENT ON column pn_area_soft_inst.create_user IS 'Creation user';
COMMENT ON column pn_area_soft_inst.create_time IS 'Creation date / time';
COMMENT ON column pn_area_soft_inst.create_institution IS 'Creation institution';
COMMENT ON column pn_area_soft_inst.update_user IS 'Update user';
COMMENT ON column pn_area_soft_inst.update_time IS 'Update date / time';
COMMENT ON column pn_area_soft_inst.update_institution IS 'Update institution';
COMMENT ON column pn_area_soft_inst.id_department IS 'Department identifier.';
COMMENT ON column pn_area_soft_inst.id_dep_clin_serv IS 'Dep_clin_serv identifier.';
COMMENT ON column pn_area_soft_inst.flg_available IS 'Flag indicating if relational record is available';
-- CHANGE END: Sofia Mendes

-- CHANGED BY: António Neto
-- CHANGE DATE: 02/01/2012 14:47
-- CHANGE REASON: [[ALERT-211833]] Fix findings - Solve findings identified by Technical Arq. BD
begin
execute immediate ('COMMENT ON TABLE PN_AREA_SOFT_INST IS ''Areas of the SOAP Notes functionalities to be parameterized by software and institution''');
exception
when others then
null;
end;
/
-- CHANGE END: António Neto

-- CHANGED BY: António Neto
-- CHANGE DATE: 02/01/2012 14:47
-- CHANGE REASON: [[ALERT-211833]] Fix findings - Solve findings identified by Technical Arq. BD
begin
execute immediate ('alter table PN_AREA_SOFT_INST modify CREATE_USER varchar2(24 CHAR)');
exception
when others then
null;
end;
/
-- CHANGE END: António Neto

-- CHANGED BY: António Neto
-- CHANGE DATE: 02/01/2012 14:47
-- CHANGE REASON: [[ALERT-211833]] Fix findings - Solve findings identified by Technical Arq. BD
begin
execute immediate ('alter table PN_AREA_SOFT_INST modify UPDATE_USER varchar2(24 CHAR)');
exception
when others then
null;
end;
/
-- CHANGE END: António Neto

-- CHANGED BY: António Neto
-- CHANGE DATE: 02/01/2012 14:48
-- CHANGE REASON: [[ALERT-211833]] Fix findings - Solve findings identified by Technical Arq. BD
begin
execute immediate ('alter table PN_AREA_SOFT_INST modify DATA_SORT_SUMMARY varchar2(0001 char)');
exception
when others then
null;
end;
/
-- CHANGE END: António Neto

-- CHANGED BY: António Neto
-- CHANGE DATE: 02/01/2012 14:48
-- CHANGE REASON: [[ALERT-211833]] Fix findings - Solve findings identified by Technical Arq. BD
begin
execute immediate ('alter table PN_AREA_SOFT_INST modify DATA_SORT_SUMMARY varchar2(0024 char)');
exception
when others then
null;
end;
/
-- CHANGE END: António Neto

-- CHANGED BY: António Neto
-- CHANGE DATE: 02/01/2012 14:48
-- CHANGE REASON: [[ALERT-211833]] Fix findings - Solve findings identified by Technical Arq. BD
begin
execute immediate ('alter table PN_AREA_SOFT_INST modify DATA_SORT_SUMMARY varchar2(0030 char)');
exception
when others then
null;
end;
/
-- CHANGE END: António Neto

-- CHANGED BY: António Neto
-- CHANGE DATE: 02/01/2012 14:48
-- CHANGE REASON: [[ALERT-211833]] Fix findings - Solve findings identified by Technical Arq. BD
begin
execute immediate ('alter table PN_AREA_SOFT_INST modify DATA_SORT_SUMMARY varchar2(0200 char)');
exception
when others then
null;
end;
/
-- CHANGE END: António Neto

-- CHANGED BY: António Neto
-- CHANGE DATE: 02/01/2012 14:48
-- CHANGE REASON: [[ALERT-211833]] Fix findings - Solve findings identified by Technical Arq. BD
begin
execute immediate ('alter table PN_AREA_SOFT_INST modify DATA_SORT_SUMMARY varchar2(1000 char)');
exception
when others then
null;
end;
/
-- CHANGE END: António Neto

-- CHANGED BY: António Neto
-- CHANGE DATE: 02/01/2012 15:50
-- CHANGE REASON: [ALERT-211833] Fix findings - Solve findings identified by Technical Arq. BD
begin
execute immediate ('COMMENT ON TABLE PN_AREA_SOFT_INST IS ''Areas of the SOAP Notes functionalities to be parameterized by software and institution''');
exception
when others then
null;
end;
/
-- CHANGE END: António Neto

-- CHANGED BY: António Neto
-- CHANGE DATE: 02/01/2012 15:50
-- CHANGE REASON: [ALERT-211833] Fix findings - Solve findings identified by Technical Arq. BD
begin
execute immediate ('alter table PN_AREA_SOFT_INST modify CREATE_USER varchar2(24 CHAR)');
exception
when others then
null;
end;
/
-- CHANGE END: António Neto

-- CHANGED BY: António Neto
-- CHANGE DATE: 02/01/2012 15:51
-- CHANGE REASON: [ALERT-211833] Fix findings - Solve findings identified by Technical Arq. BD
begin
execute immediate ('alter table PN_AREA_SOFT_INST modify UPDATE_USER varchar2(24 CHAR)');
exception
when others then
null;
end;
/
-- CHANGE END: António Neto

-- CHANGED BY: António Neto
-- CHANGE DATE: 02/01/2012 15:51
-- CHANGE REASON: [ALERT-211833] Fix findings - Solve findings identified by Technical Arq. BD
begin
execute immediate ('alter table PN_AREA_SOFT_INST modify DATA_SORT_SUMMARY varchar2(0024 char)');
exception
when others then
null;
end;
/
-- CHANGE END: António Neto

-- CHANGED BY: Sofia Mendes
-- CHANGE DATE: 18/07/2012 14:13
-- CHANGE REASON: [ALERT-236679 ] Progress notes - filter by Last X notes
BEGIN
    execute immediate 'alter table pn_area_soft_inst add (summary_default_filter VARCHAR2(1 CHAR) DEFAULT ''N'' NOT NULL)';
EXCEPTION
    WHEN OTHERS THEN
        dbms_output.put_line('operacao ja executada anteriormente');
END;
/

begin
execute immediate ('COMMENT ON COLUMN pn_area_soft_inst.summary_default_filter IS ''Default filter to apply to the summary grid. N-Last N records, D-Date filter that contains the last note.''');
exception
when others then
dbms_output.put_line('operacao ja executada anteriormente');
end;
/
-- CHANGE END: Sofia Mendes

-- CHANGED BY: Sofia Mendes
-- CHANGE DATE: 15/10/2012 16:02
-- CHANGE REASON: [ALERT-242379 ] Single page note for Discharge Summary
BEGIN
    execute immediate 'alter table pn_area_soft_inst add (TIME_TO_CLOSE_NOTE NUMBER(24))';
EXCEPTION
    WHEN OTHERS THEN
        null;
END;
/


BEGIN
    execute immediate 'COMMENT ON COLUMN pn_area_soft_inst.TIME_TO_CLOSE_NOTE IS ''Nr of minutes that the professional has to close (sign-off) the note since it is created. If no time is defined no limit is considered.''';
EXCEPTION
    WHEN OTHERS THEN
        null;
END;
/


BEGIN
    execute immediate 'alter table pn_area_soft_inst add (TIME_TO_START_DOCUM NUMBER(24))';
EXCEPTION
    WHEN OTHERS THEN
        null;
END;
/

BEGIN
    execute immediate 'COMMENT ON COLUMN pn_area_soft_inst.TIME_TO_START_DOCUM IS ''Nr of minutes that the professional has to start documenting since it is generated a system draft when discharging the patient.''';
EXCEPTION
    WHEN OTHERS THEN
        null;
END;
/
-- CHANGE END: Sofia Mendes

-- CHANGED BY: Sofia Mendes
-- CHANGE DATE: 15/01/2013 15:12
-- CHANGE REASON: [ALERT-243676 ] PPN - "Last 5 records" filter is not working properly
COMMENT ON COLUMN pn_area_soft_inst.summary_default_filter IS 'Default filter to apply to the summary grid. N-All opption, D-Date filter that contains the last note.';
/
-- CHANGE END: Sofia Mendes

-- CHANGED BY: Sofia Mendes
-- CHANGE DATE: 11/02/2013 08:09
-- CHANGE REASON: [ALERT-250486 ] A physician suggested to add the option "Anamnesi Fisiologica" (or in (truncated)
BEGIN
    EXECUTE IMMEDIATE ('ALTER TABLE PN_AREA_SOFT_INST DROP CONSTRAINT PASI_PK ');
EXCEPTION
    WHEN OTHERS THEN
        dbms_output.put_line('AVISO: Operação já executada anteriormente.');
END;
/


BEGIN
    EXECUTE IMMEDIATE ('alter table pn_area_soft_inst
  add constraint pasi_pk primary key (id_software, id_institution, id_pn_area, id_department, id_dep_clin_serv)');
EXCEPTION
    WHEN OTHERS THEN
        dbms_output.put_line('AVISO: Operação já executada anteriormente.');
END;
/
-- CHANGE END: Sofia Mendes

-- CHANGED BY: Sofia Mendes
-- CHANGE DATE: 31/05/2013 16:26
-- CHANGE REASON: [ALERT-259145] Triage single page
BEGIN
    execute immediate 'alter table pn_area_soft_inst modify (flg_available VARCHAR2(1 CHAR) not null)';
EXCEPTION
    WHEN OTHERS THEN
        dbms_output.put_line('Operação já executada anteriormente.');
END;
/

BEGIN
    execute immediate 'alter table pn_area_soft_inst modify (FLG_REPORT_TITLE_TYPE varchar2(1 char) not null)';
EXCEPTION
    WHEN OTHERS THEN
        dbms_output.put_line('Operação já executada anteriormente.');
END;
/
-- CHANGE END: Sofia Mendes

-- CHANGED BY: Paulo Teixeira
-- CHANGE DATE: 11/09/2014 14:58
-- CHANGE REASON: [ALERT-295101] 
BEGIN
    execute immediate 'alter table pn_area_soft_inst add (id_report NUMBER(24))';
EXCEPTION
    WHEN OTHERS THEN
        null;
END;
/

BEGIN
    execute immediate 'COMMENT ON COLUMN pn_area_soft_inst.id_report IS ''Reports identifier.''';
EXCEPTION
    WHEN OTHERS THEN
        null;
END;
/
-- CHANGE END: Paulo Teixeira