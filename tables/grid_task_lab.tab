  CREATE TABLE "ALERT"."GRID_TASK_LAB"
   (	"ID_PATIENT" NUMBER(24,0),
	"ID_HARVEST" NUMBER(24,0),
	"ID_EPISODE" NUMBER(24,0),
	"ID_EPIS_TYPE" NUMBER(12,0),
	"FLG_STATUS_EPIS" VARCHAR2(1),
	"ID_SOFTWARE" NUMBER(24,0),
	"DT_FIRST_OBS_TSTZ" TIMESTAMP (6) WITH LOCAL TIME ZONE,
	"ID_SAMPLE_RECIPIENT" NUMBER(12,0),
	"FLG_STATUS_ARD" VARCHAR2(1),
	"DT_TARGET_TSTZ" TIMESTAMP (6) WITH LOCAL TIME ZONE,
	"FLG_TIME_HARVEST" VARCHAR2(1),
	"DT_PEND_REQ_TSTZ" TIMESTAMP (6) WITH LOCAL TIME ZONE,
	"ACUITY" VARCHAR2(30),
	"RANK_ACUITY" VARCHAR2(30),
	"REQUEST" VARCHAR2(30),
	"HARVEST" VARCHAR2(30),
	"TRANSPORT" VARCHAR2(30),
	"EXECUTE" VARCHAR2(30),
	"COMPLETE" VARCHAR2(30),
	"DT_ORDER" TIMESTAMP (6) WITH LOCAL TIME ZONE,
	"ID_ANALYSIS_REQ" NUMBER(24,0),
	"ID_ANALYSIS_REQ_DET" NUMBER(24,0),
	"ID_INSTITUTION" NUMBER(24,0)
   ) ;


-- Para adicionar colunas pode ser usado código comentado
-- De momento só são suportados os tipos de dados mais comuns.
-- ALTER TABLE GRID_TASK_LAB ADD ID_PATIENT NUMBER(24,0) NOT NULL;
-- ALTER TABLE GRID_TASK_LAB ADD ID_HARVEST NUMBER(24,0) ;
-- ALTER TABLE GRID_TASK_LAB ADD ID_EPISODE NUMBER(24,0) NOT NULL;
-- ALTER TABLE GRID_TASK_LAB ADD ID_EPIS_TYPE NUMBER(12,0) NOT NULL;
-- ALTER TABLE GRID_TASK_LAB ADD FLG_STATUS_EPIS VARCHAR2(1) ;
-- ALTER TABLE GRID_TASK_LAB ADD ID_SOFTWARE NUMBER(24,0) NOT NULL;
-- ALTER TABLE GRID_TASK_LAB ADD DT_FIRST_OBS_TSTZ TIMESTAMP(6) WITH LOCAL TIME ZONE ;
-- ALTER TABLE GRID_TASK_LAB ADD ID_SAMPLE_RECIPIENT NUMBER(12,0) ;
-- ALTER TABLE GRID_TASK_LAB ADD FLG_STATUS_ARD VARCHAR2(1) ;
-- ALTER TABLE GRID_TASK_LAB ADD DT_TARGET_TSTZ TIMESTAMP(6) WITH LOCAL TIME ZONE ;
-- ALTER TABLE GRID_TASK_LAB ADD FLG_TIME_HARVEST VARCHAR2(1) ;
-- ALTER TABLE GRID_TASK_LAB ADD DT_PEND_REQ_TSTZ TIMESTAMP(6) WITH LOCAL TIME ZONE ;
-- ALTER TABLE GRID_TASK_LAB ADD ACUITY VARCHAR2(30) ;
-- ALTER TABLE GRID_TASK_LAB ADD RANK_ACUITY VARCHAR2(30) ;
-- ALTER TABLE GRID_TASK_LAB ADD REQUEST VARCHAR2(30) ;
-- ALTER TABLE GRID_TASK_LAB ADD HARVEST VARCHAR2(30) ;
-- ALTER TABLE GRID_TASK_LAB ADD TRANSPORT VARCHAR2(30) ;
-- ALTER TABLE GRID_TASK_LAB ADD EXECUTE VARCHAR2(30) ;
-- ALTER TABLE GRID_TASK_LAB ADD COMPLETE VARCHAR2(30) ;
-- ALTER TABLE GRID_TASK_LAB ADD DT_ORDER TIMESTAMP(6) WITH LOCAL TIME ZONE ;
-- ALTER TABLE GRID_TASK_LAB ADD ID_ANALYSIS_REQ NUMBER(24,0) NOT NULL;
-- ALTER TABLE GRID_TASK_LAB ADD ID_ANALYSIS_REQ_DET NUMBER(24,0) NOT NULL;
-- ALTER TABLE GRID_TASK_LAB ADD ID_INSTITUTION NUMBER(24,0) NOT NULL;

COMMENT ON COLUMN GRID_TASK_LAB.ID_PATIENT IS 'Patient ID';
COMMENT ON COLUMN GRID_TASK_LAB.ID_HARVEST IS 'Harvest ID';
COMMENT ON COLUMN GRID_TASK_LAB.ID_EPISODE IS 'Episode ID';
COMMENT ON COLUMN GRID_TASK_LAB.ID_EPIS_TYPE IS 'Episode Type ID';
COMMENT ON COLUMN GRID_TASK_LAB.FLG_STATUS_EPIS IS 'Episode flag status (''A''-Active / ''I''-Inactive / ''C''-Canceled / ''P'' - Pending)';
COMMENT ON COLUMN GRID_TASK_LAB.ID_SOFTWARE IS 'Software ID';
COMMENT ON COLUMN GRID_TASK_LAB.DT_FIRST_OBS_TSTZ IS 'Patient first observation date';
COMMENT ON COLUMN GRID_TASK_LAB.ID_SAMPLE_RECIPIENT IS 'Sample recipient ID';
COMMENT ON COLUMN GRID_TASK_LAB.FLG_STATUS_ARD IS 'Analysis request detail flag status (''R'' - Requested, ''E'' - In execution, ''F'' - With results, ''C'' - Canceled; ''D'' - Pending; ''L'' - Read)';
COMMENT ON COLUMN GRID_TASK_LAB.DT_TARGET_TSTZ IS 'Scheduled analysis exam date';
COMMENT ON COLUMN GRID_TASK_LAB.FLG_TIME_HARVEST IS 'Harvest flag time (''B'' - Before next episode, ''N'' - Next episode, ''E'' - Current episode)';
COMMENT ON COLUMN GRID_TASK_LAB.DT_PEND_REQ_TSTZ IS 'Date when the FLG_STATUS_ARD passed from pending to requested';
COMMENT ON COLUMN GRID_TASK_LAB.ACUITY IS 'Acuity';
COMMENT ON COLUMN GRID_TASK_LAB.RANK_ACUITY IS 'Rank acuity';
COMMENT ON COLUMN GRID_TASK_LAB.REQUEST IS 'Request column string used in lab tech grid';
COMMENT ON COLUMN GRID_TASK_LAB.HARVEST IS 'Harvest column string used in lab tech grid';
COMMENT ON COLUMN GRID_TASK_LAB.TRANSPORT IS 'Transport column string used in lab tech grid';
COMMENT ON COLUMN GRID_TASK_LAB.EXECUTE IS 'Execute column string used in lab tech grid';
COMMENT ON COLUMN GRID_TASK_LAB.COMPLETE IS 'Complete column string used in lab tech grid';
COMMENT ON COLUMN GRID_TASK_LAB.DT_ORDER IS 'Analysis exam order date';
COMMENT ON COLUMN GRID_TASK_LAB.ID_ANALYSIS_REQ IS 'Analysis request ID';
COMMENT ON COLUMN GRID_TASK_LAB.ID_ANALYSIS_REQ_DET IS 'Analysis request detail ID';
COMMENT ON COLUMN GRID_TASK_LAB.ID_INSTITUTION IS 'Institution ID';


ALTER TABLE GRID_TASK_LAB 
 ADD (GENDER VARCHAR2(1)
 ,PAT_AGE NUMBER(3)
 ,NUM_CLIN_RECORD VARCHAR2(12)
 ,ID_DEPT NUMBER(24)
 ,ID_CLINICAL_SERVICE NUMBER(12)
 )
/
COMMENT ON COLUMN GRID_TASK_LAB.GENDER IS 'Patient gender';
COMMENT ON COLUMN GRID_TASK_LAB.PAT_AGE IS 'Patient age';
COMMENT ON COLUMN GRID_TASK_LAB.NUM_CLIN_RECORD IS 'Institution''s clinical record number';
COMMENT ON COLUMN GRID_TASK_LAB.ID_DEPT IS 'Dept ID';
COMMENT ON COLUMN GRID_TASK_LAB.ID_CLINICAL_SERVICE IS 'Clinical Service ID';


ALTER TABLE GRID_TASK_LAB 
 ADD (ID_PROFESSIONAL NUMBER(24)
 ,ID_EXAM_CAT NUMBER(24)
 ,FLG_RESULT VARCHAR2(1)
 );

COMMENT ON COLUMN GRID_TASK_LAB.ID_PROFESSIONAL IS 'Professional''s ID';

COMMENT ON COLUMN GRID_TASK_LAB.ID_EXAM_CAT IS 'Category''s ID';

COMMENT ON COLUMN GRID_TASK_LAB.FLG_RESULT IS 'Indicates if the lab test has a result';

ALTER TABLE GRID_TASK_LAB drop (ID_EXAM_CAT, FLG_RESULT);

ALTER TABLE GRID_TASK_LAB 
 ADD (DT_REQ_TSTZ TIMESTAMP WITH LOCAL TIME ZONE
 );

COMMENT ON COLUMN GRID_TASK_LAB.DT_REQ_TSTZ IS 'Request date';


--20080724 - Gustavo - Validação por sala do profissional
ALTER TABLE GRID_TASK_LAB 
 ADD (ID_ROOM_REQ NUMBER(24) NOT NULL
 )
 MODIFY (FLG_STATUS_EPIS VARCHAR2(1) NOT NULL
 ,FLG_STATUS_ARD VARCHAR2(1) NOT NULL
 ,FLG_TIME_HARVEST VARCHAR2(1) NOT NULL
 ,DT_REQ_TSTZ TIMESTAMP WITH LOCAL TIME ZONE NULL
 )
/
COMMENT ON COLUMN GRID_TASK_LAB.ID_ROOM_REQ IS 'Analysis req associated laboratory'
/
--20080915 - Gustavo - Adicionar o laboratório associado à colheita
ALTER TABLE GRID_TASK_LAB 
 ADD (ID_ROOM_RECEIVE_TUBE NUMBER(24)
 )
/
ALTER TABLE GRID_TASK_LAB 
 MODIFY (ID_ROOM_REQ NUMBER(24) NULL
 )
/
COMMENT ON COLUMN GRID_TASK_LAB.ID_ROOM_RECEIVE_TUBE IS 'Harvest associated laboratory'
/
-- CHANGED BY: Gustavo Serrano
-- CHANGED DATE: 2009-04-16
-- CHANGED REASON: ALERT-24016
ALTER TABLE GRID_TASK_LAB 
 MODIFY (NUM_CLIN_RECORD VARCHAR2(100),
         ID_CLINICAL_SERVICE NUMBER(24),
         PAT_AGE NUMBER(5)
 )
/
-- CHANGE END: Gustavo Serrano

-- CHANGED BY: Jose Castro
-- CHANGE DATE: 19-03-2010
-- CHANGE REASON: ALERT-42532 and ALERT-82252
alter table GRID_TASK_LAB add ID_DEP_CLIN_SERV NUMBER(24);
comment on column GRID_TASK_LAB.ID_DEP_CLIN_SERV is 'Serviço clinico do departamento';
-- CHANGE END



-- CHANGED BY: Ana Matos
-- CHANGE DATE: 2010-05-10
-- CHANGE REASON: ALERT-812

ALTER TABLE GRID_TASK_LAB MODIFY (ID_EPISODE NULL);
ALTER TABLE GRID_TASK_LAB MODIFY (ID_EPIS_TYPE NULL);  
ALTER TABLE GRID_TASK_LAB MODIFY (FLG_STATUS_EPIS NULL); 

-- CHANGE END: Ana Matos


-- CHANGED BY: Ana Matos
-- CHANGE DATE: 2010-06-09
-- CHANGE REASON: ALERT-102668

ALTER TABLE grid_task_lab MODIFY request VARCHAR2(50);
ALTER TABLE grid_task_lab MODIFY harvest VARCHAR2(50);
ALTER TABLE grid_task_lab MODIFY transport VARCHAR2(50);
ALTER TABLE grid_task_lab MODIFY execute VARCHAR2(50);
ALTER TABLE grid_task_lab MODIFY complete VARCHAR2(50);

-- CHANGE END: Ana Matos



-- CHANGED BY: Gustavo Serrano
-- CHANGE DATE: 07/07/2010 15:50
-- CHANGE REASON: [ALERT-110074] Order sets - TDE
ALTER TABLE GRID_TASK_LAB ADD (
    ID_TASK_DEPENDENCY NUMBER(24),
    FLG_REQ_ORIGIN_MODULE VARCHAR2(1 CHAR));
    
COMMENT ON COLUMN GRID_TASK_LAB.ID_TASK_DEPENDENCY IS 'Task dependency identifier';
COMMENT ON COLUMN GRID_TASK_LAB.FLG_REQ_ORIGIN_MODULE IS 'Request created by : D - Default, O - Order Sets, I - Interfaces';
-- CHANGE END: Gustavo Serrano

-- CHANGED BY: Ana Matos
-- CHANGE DATE: 27/04/2011 10:27
-- CHANGE REASON: [ALERT-174844] 
alter table grid_task_lab modify (flg_status_ard varchar2(2 char));
-- CHANGE END: Ana Matos

-- CHANGED BY: Ana Matos
-- CHANGE DATE: 13/03/2013 10:49
-- CHANGE REASON: [ALERT-253342] 
DECLARE
    e_object_exists EXCEPTION;

    PRAGMA EXCEPTION_INIT(e_object_exists, -01430);
BEGIN
    BEGIN
        EXECUTE IMMEDIATE 'ALTER TABLE GRID_TASK_LAB ADD (ID_ANALYSIS NUMBER(12), ID_EXAM_CAT NUMBER(24), 
TRIAGE_COLOR_TEXT VARCHAR2(240), ID_TRIAGE_COLOR NUMBER(12), ID_ANNOUNCED_ARRIVAL NUMBER(24))';
    EXCEPTION
        WHEN e_object_exists THEN
            dbms_output.put_line('Column already exists');
    END;
END;
/

COMMENT ON COLUMN GRID_TASK_LAB.ID_ANALYSIS IS 'Analysis id';
COMMENT ON COLUMN GRID_TASK_LAB.ID_EXAM_CAT IS 'Exam category id';
COMMENT ON COLUMN GRID_TASK_LAB.TRIAGE_COLOR_TEXT IS 'Triage color text';
COMMENT ON COLUMN GRID_TASK_LAB.ID_TRIAGE_COLOR IS 'Triage color id';
COMMENT ON COLUMN GRID_TASK_LAB.ID_ANNOUNCED_ARRIVAL IS 'Announced arrival id';
-- CHANGE END: Ana Matos

-- CHANGED BY: Ana Matos
-- CHANGE DATE: 14/03/2013 14:33
-- CHANGE REASON: [ALERT-253342] 
begin
pk_versioning.run(i_sql => 'ALTER TABLE GRID_TASK_LAB ADD (ID_SAMPLE_TYPE NUMBER(12))');
end;
/

COMMENT ON COLUMN GRID_TASK_LAB.ID_SAMPLE_TYPE IS 'Sample type id'
-- CHANGE END: Ana Matos

-- CHANGED BY: Ana Matos
-- CHANGE DATE: 08/01/2016 12:01
-- CHANGE REASON: [ALERT-317702] 
COMMENT ON TABLE GRID_TASK_LAB IS 'Laboratory technician easy access';

COMMENT ON COLUMN GRID_TASK_LAB.ID_PATIENT IS 'Patient ID';
COMMENT ON COLUMN GRID_TASK_LAB.ID_HARVEST IS 'Harvest ID';
COMMENT ON COLUMN GRID_TASK_LAB.ID_EPISODE IS 'Episode ID';
COMMENT ON COLUMN GRID_TASK_LAB.ID_EPIS_TYPE IS 'Episode type ID';
COMMENT ON COLUMN GRID_TASK_LAB.FLG_STATUS_EPIS IS 'Flag that indicates the episode status: A - Active, I - Inactive, C - Canceled, P - Pending)';
COMMENT ON COLUMN GRID_TASK_LAB.ID_SOFTWARE IS 'Software ID';
COMMENT ON COLUMN GRID_TASK_LAB.DT_FIRST_OBS_TSTZ IS 'Patient first observation date';
COMMENT ON COLUMN GRID_TASK_LAB.ID_SAMPLE_RECIPIENT IS 'Sample recipient ID';
COMMENT ON COLUMN GRID_TASK_LAB.FLG_STATUS_ARD IS 'Flag that indicates the lab test''s order detail status';
COMMENT ON COLUMN GRID_TASK_LAB.DT_TARGET_TSTZ IS 'Date for which the order is to be performed';
COMMENT ON COLUMN GRID_TASK_LAB.FLG_TIME_HARVEST IS 'To be performed: B - Before next episode, N - Next episode, E - Current episode)';
COMMENT ON COLUMN GRID_TASK_LAB.DT_PEND_REQ_TSTZ IS 'Date that indicates when the order has been updated from pending to ordered';
COMMENT ON COLUMN GRID_TASK_LAB.ACUITY IS 'Acuity';
COMMENT ON COLUMN GRID_TASK_LAB.RANK_ACUITY IS 'Rank acuity';
COMMENT ON COLUMN GRID_TASK_LAB.REQUEST IS 'Request column string used in technician grid';
COMMENT ON COLUMN GRID_TASK_LAB.HARVEST IS 'Harvest column string used in technician grid';
COMMENT ON COLUMN GRID_TASK_LAB.TRANSPORT IS 'Transport column string used in technician grid';
COMMENT ON COLUMN GRID_TASK_LAB.EXECUTE IS 'Execute column string used in technician grid';
COMMENT ON COLUMN GRID_TASK_LAB.COMPLETE IS 'Complete column string used in technician grid';
COMMENT ON COLUMN GRID_TASK_LAB.DT_ORDER IS 'Lab test order date';
COMMENT ON COLUMN GRID_TASK_LAB.ID_ANALYSIS_REQ IS 'Order''s ID';
COMMENT ON COLUMN GRID_TASK_LAB.ID_ANALYSIS_REQ_DET IS 'Lab test''s order detail ID';
COMMENT ON COLUMN GRID_TASK_LAB.ID_INSTITUTION IS 'Institution ID';
COMMENT ON COLUMN GRID_TASK_LAB.GENDER IS 'Patient gender';
COMMENT ON COLUMN GRID_TASK_LAB.PAT_AGE IS 'Patient age';
COMMENT ON COLUMN GRID_TASK_LAB.NUM_CLIN_RECORD IS 'Institution''s clinical record number';
COMMENT ON COLUMN GRID_TASK_LAB.ID_DEPT IS 'Dept ID';
COMMENT ON COLUMN GRID_TASK_LAB.ID_CLINICAL_SERVICE IS 'Clinical service ID';
COMMENT ON COLUMN GRID_TASK_LAB.ID_PROFESSIONAL IS 'Professional''s ID';
COMMENT ON COLUMN GRID_TASK_LAB.DT_REQ_TSTZ IS 'Request date';
COMMENT ON COLUMN GRID_TASK_LAB.ID_ROOM_REQ IS 'Execution place ID';
COMMENT ON COLUMN GRID_TASK_LAB.ID_ROOM_RECEIVE_TUBE IS 'Harvest place ID';
COMMENT ON COLUMN GRID_TASK_LAB.CREATE_USER IS 'Creation User';
COMMENT ON COLUMN GRID_TASK_LAB.CREATE_TIME IS 'Creation Time';
COMMENT ON COLUMN GRID_TASK_LAB.CREATE_INSTITUTION IS 'Creation Institution';
COMMENT ON COLUMN GRID_TASK_LAB.UPDATE_USER IS 'Update User';
COMMENT ON COLUMN GRID_TASK_LAB.UPDATE_TIME IS 'Update Time';
COMMENT ON COLUMN GRID_TASK_LAB.UPDATE_INSTITUTION IS 'Update Institution';
COMMENT ON COLUMN GRID_TASK_LAB.ID_DEP_CLIN_SERV IS 'Clinical service ID';
COMMENT ON COLUMN GRID_TASK_LAB.ID_TASK_DEPENDENCY IS 'Task dependency ID';
COMMENT ON COLUMN GRID_TASK_LAB.FLG_REQ_ORIGIN_MODULE IS 'Request created by: D - Default, O - Order sets, I - Interfaces R - Referral';
COMMENT ON COLUMN GRID_TASK_LAB.ID_ANALYSIS IS 'Lab test ID';
COMMENT ON COLUMN GRID_TASK_LAB.ID_EXAM_CAT IS 'Lab test''s category ID';
COMMENT ON COLUMN GRID_TASK_LAB.TRIAGE_COLOR_TEXT IS 'Triage color text';
COMMENT ON COLUMN GRID_TASK_LAB.ID_TRIAGE_COLOR IS 'Triage color ID';
COMMENT ON COLUMN GRID_TASK_LAB.ID_ANNOUNCED_ARRIVAL IS 'Announced arrival ID';
COMMENT ON COLUMN GRID_TASK_LAB.ID_SAMPLE_TYPE IS 'Sample type ID';
-- CHANGE END: Ana Matos

-- CHANGED BY: Ana Matos
-- CHANGE DATE: 04/04/2016 10:57
-- CHANGE REASON: [ALERT-319949] 
ALTER TABLE grid_task_lab MODIFY request VARCHAR2(200 CHAR);
ALTER TABLE grid_task_lab MODIFY harvest VARCHAR2(200 CHAR);
ALTER TABLE grid_task_lab MODIFY transport VARCHAR2(200 CHAR);
ALTER TABLE grid_task_lab MODIFY execute VARCHAR2(200 CHAR);
ALTER TABLE grid_task_lab MODIFY complete VARCHAR2(200 CHAR);
-- CHANGE END: Ana Matos

-- CHANGED BY: Diogo Oliveira
-- CHANGE DATE: 24/02/2021 14:37
-- CHANGE REASON: [EMR-42343] - Change the descriptions of the "Start date" and "Date to be defined" fields.
comment on column GRID_TASK_LAB.FLG_TIME_HARVEST is 'To be performed: E - this episode; B - before next episode; N - next episode; D - On a defined or to be defined date';
-- CHANGE END: Diogo Oliveira