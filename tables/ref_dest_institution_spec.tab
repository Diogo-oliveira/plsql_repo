-- CHANGED BY:  Filipe Sousa
-- CHANGE DATE: 02/12/2010 11:57
-- CHANGE REASON: [ALERT-146258] A rede de referenciação inter-hositalar deverá suportar que uma instituição seja destino dentro e fora da rede de referenciação conforme a especialidade em causa. (ALERT142962)
PROMPT Creating Table 'REF_DEST_INSTITUTION_SPEC'
CREATE TABLE REF_DEST_INSTITUTION_SPEC
 (ID_DEST_INSTITUTION_SPEC NUMBER(24) NOT NULL
 ,ID_DEST_INSTITUTION NUMBER(24) NOT NULL
 ,ID_SPECIALITY NUMBER(6) NOT NULL
 ,FLG_AVAILABLE VARCHAR2(1) NOT NULL
 ,FLG_INSIDE_REF_AREA VARCHAR2(1) NOT NULL
 ,CREATE_USER VARCHAR2(24)
 ,CREATE_TIME TIMESTAMP WITH LOCAL TIME ZONE
 ,CREATE_INSTITUTION NUMBER(24)
 ,UPDATE_USER VARCHAR2(24)
 ,UPDATE_TIME TIMESTAMP WITH LOCAL TIME ZONE
 ,UPDATE_INSTITUTION NUMBER(24)
 )
 STORAGE
 (
   INITIAL 65536
   MINEXTENTS 1
   MAXEXTENTS UNLIMITED
 )
 TABLESPACE INDEX_L
/

COMMENT ON COLUMN REF_DEST_INSTITUTION_SPEC.FLG_AVAILABLE IS 'Y - Available; N - not Available'
/

COMMENT ON COLUMN REF_DEST_INSTITUTION_SPEC.FLG_INSIDE_REF_AREA IS 'Y - Inside hospital referral area; N - Otherwise'
/

COMMENT ON COLUMN REF_DEST_INSTITUTION_SPEC.CREATE_USER IS 'Creation User'
/

COMMENT ON COLUMN REF_DEST_INSTITUTION_SPEC.CREATE_TIME IS 'Creation Time'
/

COMMENT ON COLUMN REF_DEST_INSTITUTION_SPEC.CREATE_INSTITUTION IS 'Creation Institution'
/

COMMENT ON COLUMN REF_DEST_INSTITUTION_SPEC.UPDATE_USER IS 'Update User'
/

COMMENT ON COLUMN REF_DEST_INSTITUTION_SPEC.UPDATE_TIME IS 'Update Time'
/

COMMENT ON COLUMN REF_DEST_INSTITUTION_SPEC.UPDATE_INSTITUTION IS 'Update Institution'
/

-- CHANGE END:  Filipe Sousa

-- CHANGED BY:  Filipe Sousa
-- CHANGE DATE: 09/12/2010 17:24
-- CHANGE REASON: [ALERT-146258] A rede de referenciação inter-hositalar deverá suportar que uma instituição seja destino dentro e fora da rede de referenciação conforme a especialidade em causa. (ALERT142962)
DECLARE
already_exists EXCEPTION;
PRAGMA EXCEPTION_INIT(already_exists, -00955);
BEGIN
EXECUTE IMMEDIATE 'CREATE TABLE REF_DEST_INSTITUTION_SPEC
 (ID_DEST_INSTITUTION_SPEC NUMBER(24) NOT NULL
 ,ID_DEST_INSTITUTION NUMBER(24) NOT NULL
 ,ID_SPECIALITY NUMBER(6) NOT NULL
 ,FLG_AVAILABLE VARCHAR2(1) NOT NULL
 ,FLG_INSIDE_REF_AREA VARCHAR2(1) NOT NULL
 ,CREATE_USER VARCHAR2(24)
 ,CREATE_TIME TIMESTAMP WITH LOCAL TIME ZONE
 ,CREATE_INSTITUTION NUMBER(24)
 ,UPDATE_USER VARCHAR2(24)
 ,UPDATE_TIME TIMESTAMP WITH LOCAL TIME ZONE
 ,UPDATE_INSTITUTION NUMBER(24)
 )
 STORAGE
 (
   INITIAL 65536
   MINEXTENTS 1
   MAXEXTENTS UNLIMITED
 )
 TABLESPACE INDEX_L';

EXECUTE IMMEDIATE 'COMMENT ON COLUMN REF_DEST_INSTITUTION_SPEC.FLG_AVAILABLE IS ''Y - Available; N - not Available''';

EXECUTE IMMEDIATE 'COMMENT ON COLUMN REF_DEST_INSTITUTION_SPEC.FLG_INSIDE_REF_AREA IS ''Y - Inside hospital referral area; N - Otherwise''';

EXECUTE IMMEDIATE 'COMMENT ON COLUMN REF_DEST_INSTITUTION_SPEC.CREATE_USER IS ''Creation User''';

EXECUTE IMMEDIATE 'COMMENT ON COLUMN REF_DEST_INSTITUTION_SPEC.CREATE_TIME IS ''Creation Time''';

EXECUTE IMMEDIATE 'COMMENT ON COLUMN REF_DEST_INSTITUTION_SPEC.CREATE_INSTITUTION IS ''Creation Institution''';

EXECUTE IMMEDIATE 'COMMENT ON COLUMN REF_DEST_INSTITUTION_SPEC.UPDATE_USER IS ''Update User''';

EXECUTE IMMEDIATE 'COMMENT ON COLUMN REF_DEST_INSTITUTION_SPEC.UPDATE_TIME IS ''Update Time''';

EXECUTE IMMEDIATE 'COMMENT ON COLUMN REF_DEST_INSTITUTION_SPEC.UPDATE_INSTITUTION IS ''Update Institution''';
EXCEPTION
WHEN already_exists THEN
dbms_output.put_line('Already exists.');
END;
/

-- CHANGE END:  Filipe Sousa

-- CHANGED BY: Ana Monteiro
-- CHANGE DATE: 11/01/2011 14:30
-- CHANGE REASON: [ALERT-154620] 
comment on column REF_DEST_INSTITUTION_SPEC.ID_DEST_INSTITUTION_SPEC is 'Primary key';
comment on column REF_DEST_INSTITUTION_SPEC.ID_DEST_INSTITUTION is 'Destination institution identifier';
comment on column REF_DEST_INSTITUTION_SPEC.ID_SPECIALITY is 'P1 speciality identifier';
-- CHANGE END: Ana Monteiro

-- CHANGED BY: Ana Monteiro
-- CHANGE DATE: 11/02/2014 08:35
-- CHANGE REASON: [ALERT-276023] 
alter table REF_DEST_INSTITUTION_SPEC modify flg_available VARCHAR2(1 CHAR);
alter table REF_DEST_INSTITUTION_SPEC modify flg_inside_ref_area VARCHAR2(1 CHAR);
alter table REF_DEST_INSTITUTION_SPEC modify create_user VARCHAR2(30 CHAR);
alter table REF_DEST_INSTITUTION_SPEC modify update_user VARCHAR2(30 CHAR);

BEGIN
    pk_versioning.run(i_sql => q'[alter table REF_DEST_INSTITUTION_SPEC add flg_ref_line varchar2(30 CHAR)]');
END;
/

comment on column REF_DEST_INSTITUTION_SPEC.flg_ref_line is 'Referral line 1,2,3';
-- CHANGE END: Ana Monteiro

-- CHANGED BY: Ana Monteiro
-- CHANGE DATE: 11/02/2014 09:05
-- CHANGE REASON: [ALERT-276023] 
alter table REF_DEST_INSTITUTION_SPEC modify flg_ref_line not null;
-- CHANGE END: Ana Monteiro

-- CHANGED BY: Ana Monteiro
-- CHANGE DATE: 08/01/2015 16:00
-- CHANGE REASON: [ALERT-280039] 
alter table REF_DEST_INSTITUTION_SPEC modify flg_ref_line null;
-- CHANGE END: Ana Monteiro

-- CHANGED BY: Ana Matos
-- CHANGE DATE: 16/06/2015 16:38
-- CHANGE REASON: [ALERT-312671] 
begin
pk_versioning.run(i_sql => 'ALTER TABLE REF_DEST_INSTITUTION_SPEC MODIFY ID_SPECIALITY NUMBER(24)');
end;
/
-- CHANGE END: Ana Matos

-- CHANGED BY: Joao Sa
-- ISSUE: ALERT-317695 Database model documentation and comments corretions
comment on table REF_DEST_INSTITUTION_SPEC
  is 'Available referral specialties by institution';
-- Add comments to the columns 
comment on column REF_DEST_INSTITUTION_SPEC.id_dest_institution
  is 'Destination institution';
comment on column REF_DEST_INSTITUTION_SPEC.id_speciality
  is 'Referral speciality';
comment on column REF_DEST_INSTITUTION_SPEC.flg_available
  is 'Is available? Y/N';
comment on column REF_DEST_INSTITUTION_SPEC.flg_inside_ref_area
  is 'Is inside hospital referral area? Y/N';
