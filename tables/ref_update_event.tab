-- CHANGED BY: Ana Monteiro
-- CHANGE DATE: 08/03/2010 14:06
-- CHANGE REASON: [ALERT-79864] 
DECLARE
    l_count PLS_INTEGER;
    l_sql   VARCHAR2(1000 CHAR);
BEGIN
    SELECT COUNT(1)
      INTO l_count
      FROM all_objects
     WHERE object_name = 'REF_UPDATE_EVENT';

    IF l_count = 0
    THEN
        l_sql := 'CREATE TABLE REF_UPDATE_EVENT
 (ID_EXTERNAL_REQUEST NUMBER(24) NOT NULL
 ,FLG_STATUS VARCHAR2(1) NOT NULL
 ,DT_STATUS_TSTZ TIMESTAMP WITH LOCAL TIME ZONE NOT NULL
 ,CREATE_USER VARCHAR2(24)
 ,CREATE_TIME TIMESTAMP WITH LOCAL TIME ZONE
 ,CREATE_INSTITUTION NUMBER(24)
 ,UPDATE_USER VARCHAR2(24)
 ,UPDATE_TIME TIMESTAMP WITH LOCAL TIME ZONE
 ,UPDATE_INSTITUTION NUMBER(24)
 ,CONSTRAINT RUT_PK PRIMARY KEY 
  (ID_EXTERNAL_REQUEST
  ,FLG_STATUS
  ,DT_STATUS_TSTZ)
 )
 ORGANIZATION INDEX';
        EXECUTE IMMEDIATE l_sql;

l_sql := q'[COMMENT ON COLUMN REF_UPDATE_EVENT.ID_EXTERNAL_REQUEST IS 'Referral number ID']';
EXECUTE IMMEDIATE l_sql;

l_sql := q'[COMMENT ON COLUMN REF_UPDATE_EVENT.FLG_STATUS IS 'Indicates if the referral had any update (U) or  if the update was consumed already (C)']';
EXECUTE IMMEDIATE l_sql;

l_sql := q'[COMMENT ON COLUMN REF_UPDATE_EVENT.DT_STATUS_TSTZ IS 'Date of the status update']';
EXECUTE IMMEDIATE l_sql;

l_sql := q'[COMMENT ON COLUMN REF_UPDATE_EVENT.CREATE_USER IS 'Creation User']';
EXECUTE IMMEDIATE l_sql;

l_sql := q'[COMMENT ON COLUMN REF_UPDATE_EVENT.CREATE_TIME IS 'Creation Time']';
EXECUTE IMMEDIATE l_sql;

l_sql := q'[COMMENT ON COLUMN REF_UPDATE_EVENT.CREATE_INSTITUTION IS 'Creation Institution']';
EXECUTE IMMEDIATE l_sql;

l_sql := q'[COMMENT ON COLUMN REF_UPDATE_EVENT.UPDATE_USER IS 'Update User']';
EXECUTE IMMEDIATE l_sql;

l_sql := q'[COMMENT ON COLUMN REF_UPDATE_EVENT.UPDATE_TIME IS 'Update Time']';
EXECUTE IMMEDIATE l_sql;

l_sql := q'[COMMENT ON COLUMN REF_UPDATE_EVENT.UPDATE_INSTITUTION IS 'Update Institution']';
EXECUTE IMMEDIATE l_sql;

    END IF;
END;
/
-- CHANGE END: Ana Monteiro